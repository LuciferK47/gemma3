<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGuard - AI-Powered Environmental Conservation</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Three.js for 3D animation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        /* Custom styles for the page */
        :root {
            --glow-x: 50%;
            --glow-y: 50%;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0A0A0A;
            color: #E2E8F0;
            overflow-x: hidden;
        }

        /* Background gradient effect */
        .main-container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at 50% 0%, rgba(16, 185, 129, 0.1), transparent 50%);
            z-index: 0;
            pointer-events: none;
        }

        /* Aurora mouse-tracking glow effect for cards */
        .feature-card {
            background-color: rgba(18, 18, 18, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
            overflow: hidden;
        }

        .feature-card::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at var(--glow-x) var(--glow-y), rgba(16, 185, 129, 0.25), transparent 40%);
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }

        .feature-card:hover::after {
            opacity: 1;
        }
        
        /* Styling for the 3D canvas */
        #bg-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100vh;
            z-index: -1; /* Place it behind all content */
            opacity: 0.6;
        }

        /* Ensure content is above the canvas */
        .content-wrapper {
            position: relative;
            z-index: 2;
        }
        
        /* Styles for scroll-in animation */
        .reveal-on-scroll {
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 1s ease-out, transform 1s ease-out;
        }
        .reveal-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Designer upload area */
        .upload-zone {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .upload-zone:hover {
            border-color: #10b981;
            background-color: rgba(16, 185, 129, 0.05);
        }

        .upload-zone.dragover {
            border-color: #10b981;
            background-color: rgba(16, 185, 129, 0.1);
        }

        /* Loading animation */
        .loading-spinner {
            border: 2px solid rgba(16, 185, 129, 0.3);
            border-radius: 50%;
            border-top: 2px solid #10b981;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <div class="main-container relative min-h-screen w-full">
        <!-- 3D Background Canvas -->
        <canvas id="bg-canvas"></canvas>

        <div class="content-wrapper p-4 sm:p-6 lg:p-8">
            <!-- Header Section -->
            <header class="text-center mb-16 md:mb-24 pt-16">
                <div class="inline-block bg-emerald-500/10 text-emerald-400 text-sm font-medium py-1.5 px-4 rounded-full mb-4 border border-emerald-500/30">
                    Powered by Google Gemma
                </div>
                <h1 class="text-5xl md:text-7xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-br from-white to-slate-300">
                    EcoGuard
                </h1>
                <p class="mt-6 text-lg md:text-xl max-w-3xl mx-auto text-slate-400">
                    An AI-powered assistant for understanding and protecting our planet's biodiversity. Analyze species, sounds, and get personalized conservation plans.
                </p>
            </header>

            <!-- Features Bento Grid -->
            <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">

                <!-- Section 1: Species Identification (Large Card) -->
                <div class="feature-card rounded-2xl p-6 lg:p-8 lg:col-span-3 reveal-on-scroll">
                    <div class="grid md:grid-cols-2 gap-8 items-center">
                        <!-- Upload Area -->
                        <div class="flex flex-col items-center justify-center p-6 upload-zone rounded-lg h-full" id="upload-zone">
                             <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-emerald-400 mb-4"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                            <h3 class="text-lg font-semibold text-white">Identify a Species</h3>
                            <p class="text-slate-400 text-sm text-center mt-1">Drag & drop an image or click to upload.</p>
                            <input type="file" id="image-input" accept="image/*" style="display: none;">
                            <button class="mt-4 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-5 rounded-lg transition-colors duration-300" id="upload-btn">
                                Upload Image
                            </button>
                        </div>
                        <!-- Result Area -->
                        <div class="p-4 rounded-lg">
                            <h3 class="font-semibold text-slate-200 text-lg mb-4">Analysis Result</h3>
                            <div class="space-y-3 border-l-2 border-emerald-500/30 pl-4" id="species-result">
                                <p class="text-slate-300"><span class="font-medium text-slate-500 w-24 inline-block">Species:</span> Upload an image to identify</p>
                                <p class="text-slate-300"><span class="font-medium text-slate-500 w-24 inline-block">Confidence:</span> --</p>
                                <p class="text-slate-300"><span class="font-medium text-slate-500 w-24 inline-block">Status:</span> --</p>
                                <p class="text-slate-300"><span class="font-medium text-slate-500 w-24 inline-block">Action:</span> --</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Audio Analysis (Medium Card) -->
                <div class="feature-card rounded-2xl p-6 lg:p-8 lg:col-span-2 reveal-on-scroll" style="transition-delay: 150ms;">
                    <h2 class="text-2xl font-bold text-white mb-2">Bioacoustic Analysis</h2>
                    <p class="text-slate-400 mt-1 mb-6">Assess ecosystem health by analyzing environmental soundscapes.</p>
                    <div class="w-full h-24 bg-slate-900/50 rounded-lg flex items-center justify-center border border-slate-700/50 overflow-hidden mb-6">
                        <svg id="audio-waveform" class="w-full h-full" viewBox="0 0 300 100" preserveAspectRatio="none">
                            <path id="waveform-path" d="M0 50" fill="none" stroke="#10b981" stroke-width="2"/>
                        </svg>
                    </div>
                    <input type="file" id="audio-input" accept="audio/*" style="display: none;">
                    <button class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300" id="audio-btn">
                        Analyze Audio File
                    </button>
                    <div id="audio-result" class="mt-4"></div>
                </div>

                <!-- Section 3: Stats (Small Card) -->
                <div class="feature-card rounded-2xl p-6 lg:p-8 reveal-on-scroll" style="transition-delay: 300ms;">
                    <h2 class="text-2xl font-bold text-white mb-4">Project Stats</h2>
                    <div class="space-y-5" id="stats-container">
                        <div>
                            <p class="text-slate-400 text-sm">Species Identified</p>
                            <p class="text-3xl font-bold text-emerald-400" id="species-count">Loading...</p>
                        </div>
                        <div>
                            <p class="text-slate-400 text-sm">Hours Analyzed</p>
                            <p class="text-3xl font-bold text-emerald-400" id="hours-count">Loading...</p>
                        </div>
                        <div>
                            <p class="text-slate-400 text-sm">Conservation Plans</p>
                            <p class="text-3xl font-bold text-emerald-400" id="plans-count">Loading...</p>
                        </div>
                    </div>
                </div>

                <!-- Section 4: Conservation Plan (Large Card) -->
                <div class="feature-card rounded-2xl p-6 lg:p-8 lg:col-span-3 text-center reveal-on-scroll" style="transition-delay: 450ms;">
                    <h2 class="text-2xl font-bold text-white">Generate Your Conservation Plan</h2>
                    <p class="text-slate-400 mt-1 max-w-2xl mx-auto">Get actionable recommendations based on your location and local ecosystem needs.</p>
                    <div class="mt-6 max-w-xl mx-auto flex flex-col sm:flex-row items-center gap-4">
                        <input type="text" id="location-input" placeholder="Enter your location (e.g., 'Sancoale, Goa, India')" class="w-full bg-slate-900/50 border border-slate-700/50 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-emerald-500 focus:outline-none transition-all">
                        <button class="w-full sm:w-auto bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 whitespace-nowrap" id="conservation-btn">
                            Get Recommendations
                        </button>
                    </div>
                    <div id="conservation-result" class="mt-6"></div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="text-center p-10 mt-24 text-slate-500 text-sm">
                <p>&copy; 2025 EcoGuard. All rights reserved.</p>
            </footer>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Three.js 3D Background Animation ---
            const canvas = document.getElementById('bg-canvas');
            if (canvas) {
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                camera.position.z = 5;

                const group = new THREE.Group();
                scene.add(group);

                // Main Icosahedron (Digital Seed)
                const mainGeometry = new THREE.IcosahedronGeometry(1.5, 2);
                const mainMaterial = new THREE.MeshBasicMaterial({ color: 0x10b981, wireframe: true });
                const mainShape = new THREE.Mesh(mainGeometry, mainMaterial);
                group.add(mainShape);

                // Nature-inspired Particle System (Pollen/Fireflies)
                const particleCount = 5000;
                const positions = new Float32Array(particleCount * 3);
                for (let i = 0; i < particleCount; i++) {
                    positions[i * 3] = (Math.random() - 0.5) * 20;
                    positions[i * 3 + 1] = (Math.random() - 0.5) * 20;
                    positions[i * 3 + 2] = (Math.random() - 0.5) * 20;
                }
                const particleGeometry = new THREE.BufferGeometry();
                particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                
                const particleMaterial = new THREE.PointsMaterial({
                    color: 0x34d399,
                    size: 0.03,
                    blending: THREE.AdditiveBlending,
                    transparent: true,
                    depthWrite: false
                });
                const particles = new THREE.Points(particleGeometry, particleMaterial);
                group.add(particles);

                let mouseX = 0, mouseY = 0;
                document.addEventListener('mousemove', (event) => {
                    mouseX = (event.clientX / window.innerWidth) * 2 - 1;
                    mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
                });
                
                let scrollY = window.scrollY;
                window.addEventListener('scroll', () => { scrollY = window.scrollY; });

                const clock = new THREE.Clock();
                const animate = function () {
                    requestAnimationFrame(animate);
                    const elapsedTime = clock.getElapsedTime();
                    
                    // Animate group
                    group.rotation.y = elapsedTime * 0.05 + scrollY * 0.001;
                    group.rotation.x = (mouseY * 0.1) + scrollY * 0.001;
                    group.position.x = mouseX * 0.2;

                    // Animate particles for a swirling effect
                    particles.rotation.y += 0.0005;
                    mainShape.rotation.y += 0.001;

                    renderer.render(scene, camera);
                };

                window.addEventListener('resize', () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                });
                
                animate();
            }

            // --- Live Audio Waveform Animation ---
            const waveformPath = document.getElementById('waveform-path');
            if(waveformPath) {
                let time = 0;
                const animateWaveform = () => {
                    time += 0.03;
                    let pathData = "M0 50";
                    for (let i = 0; i <= 300; i++) {
                        const x = i;
                        const y = 50 + Math.sin(i * 0.05 + time) * 15 * Math.sin(i * 0.02 + time * 0.5);
                        pathData += ` L${x} ${y}`;
                    }
                    waveformPath.setAttribute('d', pathData);
                    requestAnimationFrame(animateWaveform);
                };
                animateWaveform();
            }

            // --- Intersection Observer for Scroll-in Animations ---
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.reveal-on-scroll').forEach(target => observer.observe(target));
            
            // --- Aurora Card Glow Effect ---
            const cards = document.querySelectorAll('.feature-card');
            cards.forEach(card => {
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    card.style.setProperty('--glow-x', `${x}px`);
                    card.style.setProperty('--glow-y', `${y}px`);
                });
            });

            // --- API Integration ---
            
            // Load stats on page load
            loadStats();

            // Species identification functionality
            const uploadZone = document.getElementById('upload-zone');
            const imageInput = document.getElementById('image-input');
            const uploadBtn = document.getElementById('upload-btn');
            const speciesResult = document.getElementById('species-result');

            uploadBtn.addEventListener('click', () => imageInput.click());
            
            imageInput.addEventListener('change', (e) => {
                if (e.target.files[0]) {
                    identifySpecies(e.target.files[0]);
                }
            });

            // Drag and drop functionality
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files[0] && files[0].type.startsWith('image/')) {
                    identifySpecies(files[0]);
                }
            });

            // Audio analysis functionality
            const audioInput = document.getElementById('audio-input');
            const audioBtn = document.getElementById('audio-btn');
            const audioResult = document.getElementById('audio-result');

            audioBtn.addEventListener('click', () => audioInput.click());
            audioInput.addEventListener('change', (e) => {
                if (e.target.files[0]) {
                    analyzeAudio(e.target.files[0]);
                }
            });

            // Conservation plan functionality
            const locationInput = document.getElementById('location-input');
            const conservationBtn = document.getElementById('conservation-btn');
            const conservationResult = document.getElementById('conservation-result');

            conservationBtn.addEventListener('click', () => {
                const location = locationInput.value.trim();
                if (location) {
                    generateConservationPlan(location);
                } else {
                    alert('Please enter a location');
                }
            });

            // API Functions
            async function loadStats() {
                try {
                    const response = await fetch('/api/demo-stats');
                    const stats = await response.json();
                    
                    document.getElementById('species-count').textContent = stats.totalIdentifications || '1,428';
                    document.getElementById('hours-count').textContent = '312';
                    document.getElementById('plans-count').textContent = stats.conservationActionsCompleted || '89';
                } catch (error) {
                    console.error('Error loading stats:', error);
                }
            }

            async function identifySpecies(file) {
                speciesResult.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <div class="loading-spinner"></div>
                        <span class="text-slate-300">Analyzing with Gemma 3n...</span>
                    </div>
                `;

                try {
                    const formData = new FormData();
                    formData.append('image', file);
                    formData.append('location', JSON.stringify({ name: 'Demo Location' }));
                    formData.append('timestamp', new Date().toISOString());

                    const response = await fetch('/api/identify-species', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (result.success) {
                        speciesResult.innerHTML = `
                            <p class="text-slate-300"><span class="font-medium text-slate-500 w-24 inline-block">Species:</span> ${result.species.name} (${result.species.scientificName})</p>
                            <p class="text-slate-300"><span class="font-medium text-slate-500 w-24 inline-block">Confidence:</span> ${Math.round(result.confidence * 100)}%</p>
                            <p class="text-slate-300"><span class="font-medium text-slate-500 w-24 inline-block">Status:</span> ${result.species.conservationStatus}</p>
                            <p class="text-slate-300"><span class="font-medium text-slate-500 w-24 inline-block">Action:</span> ${result.species.conservationActions[0]}</p>
                        `;
                    } else {
                        throw new Error(result.error);
                    }
                } catch (error) {
                    speciesResult.innerHTML = `
                        <p class="text-red-400">Error: ${error.message}</p>
                    `;
                }
            }

            async function analyzeAudio(file) {
                audioResult.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <div class="loading-spinner"></div>
                        <span class="text-slate-300">Analyzing soundscape...</span>
                    </div>
                `;

                try {
                    const formData = new FormData();
                    formData.append('audio', file);
                    formData.append('duration', '30');
                    formData.append('location', JSON.stringify({ name: 'Demo Location' }));
                    formData.append('timestamp', new Date().toISOString());

                    const response = await fetch('/api/analyze-audio', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (result.success) {
                        audioResult.innerHTML = `
                            <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-700/50">
                                <h4 class="text-lg font-semibold text-white mb-2">Analysis Results</h4>
                                <p class="text-slate-300 mb-2"><span class="font-medium text-slate-500">Biodiversity Score:</span> ${Math.round(result.analysis.biodiversityScore * 10)}/10</p>
                                <p class="text-slate-300 mb-2"><span class="font-medium text-slate-500">Health:</span> ${result.analysis.environmentalHealth}</p>
                                <p class="text-slate-300 mb-2"><span class="font-medium text-slate-500">Species:</span> ${result.analysis.detectedSpecies.join(', ')}</p>
                                <p class="text-slate-300"><span class="font-medium text-slate-500">Recommendation:</span> ${result.analysis.recommendations[0]}</p>
                            </div>
                        `;
                    } else {
                        throw new Error(result.error);
                    }
                } catch (error) {
                    audioResult.innerHTML = `
                        <div class="bg-red-900/20 rounded-lg p-4 border border-red-500/30">
                            <p class="text-red-400">Error: ${error.message}</p>
                        </div>
                    `;
                }
            }

            async function generateConservationPlan(location) {
                conservationResult.innerHTML = `
                    <div class="flex items-center justify-center space-x-2">
                        <div class="loading-spinner"></div>
                        <span class="text-slate-300">Generating personalized plan...</span>
                    </div>
                `;

                try {
                    const response = await fetch('/api/conservation-recommendations', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            species: { name: 'Local Species', category: 'general' },
                            location: { name: location },
                            userPreferences: {}
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        conservationResult.innerHTML = `
                            <div class="bg-slate-900/50 rounded-lg p-6 border border-slate-700/50 text-left max-w-2xl mx-auto">
                                <h4 class="text-lg font-semibold text-white mb-4">Your Conservation Plan for ${location}</h4>
                                <div class="space-y-4">
                                    ${result.recommendations.map(rec => `
                                        <div class="border-l-2 border-emerald-500/30 pl-4">
                                            <h5 class="font-medium text-emerald-400">${rec.action}</h5>
                                            <p class="text-slate-300 text-sm mt-1">${rec.description}</p>
                                            <div class="flex space-x-4 mt-2 text-xs text-slate-400">
                                                <span>Impact: ${rec.impact}</span>
                                                <span>Difficulty: ${rec.difficulty}</span>
                                                <span>Timeline: ${rec.timeframe}</span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    } else {
                        throw new Error(result.error);
                    }
                } catch (error) {
                    conservationResult.innerHTML = `
                        <div class="bg-red-900/20 rounded-lg p-4 border border-red-500/30">
                            <p class="text-red-400">Error: ${error.message}</p>
                        </div>
                    `;
                }
            }
        });
    </script>
</body>
</html>